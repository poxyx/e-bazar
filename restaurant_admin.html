<!DOCTYPE html>
<html lang="en">

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="">
  <meta name="author" content="">

  <title>E-bazar in Ranau Town | Order Now </title>

  <!-- Bootstrap core CSS -->
  <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">

  <!-- Custom fonts for this template -->
  <link href="vendor/fontawesome-free/css/all.min.css" rel="stylesheet">
  <link href="vendor/simple-line-icons/css/simple-line-icons.css" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Lato:300,400,700,300italic,400italic,700italic" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.0/css/all.css" integrity="sha384-lZN37f5QGtY3VHgisS14W3ExzMWZxybE1SJSEsQp9S+oqd12jhcu+A56Ebc1zFSJ" crossorigin="anonymous">

  <!-- Custom styles for this template -->
  <link href="css/main.css" rel="stylesheet">

</head>

<body onload="getUser()">

  <!-- Navigation -->
  <nav class="navbar navbar-light bg-light fixed-top bg-white shadow-sm">
    <div class="container">
      <a class="navbar-brand purple" href="#"><b class="purple">E-BAZAR</b></a>
      <a class="text-decoration-none border-0 rounded-0 purple trigger-btn" href="#loginModal" id="login_menu" data-toggle="modal">
        <i class="far fa-user purple mr-2"></i> LOGIN
      </a>
      <div class="dropdown" id="user_menu" style="display: none;">
        <a class="dropdown-toggle purple" data-toggle="dropdown">
          <i class="far fa-user purple mr-2"></i> <span id="user_login">USER</span>
        </a>
        <div class="dropdown-menu mr-5 mt-3 rounded-0">
          <a class="dropdown-item" href="#">My orders</a>
          <a class="dropdown-item" href="#">Profile</a>
          <a class="dropdown-item" href="#">Help</a>
          <a class="dropdown-item" href="#" onclick="event.preventDefault(); logoutUser();">Logout</a>
        </div>
      </div>
    </div>
  </nav>

  <br><br>


    <div class="container mt-5">
    <span><h4><b class="purple d-flex justify-content-center">ADD MENU</b></h4></span>
    <br>
    <img class="mb-4" src="./img/item.svg" alt="Card image" width="100%" height="200px">
      <div class="row mt-3 mb-3">
            <div class="col-12 col-md-12">
                <ul class="list-group rounded-0" id="menu_list">
                  <li class="list-group-item border-0 rounded-0">
                    <div class="spinner-border d-flex justify-content-center""></div>
                  </li>
                </ul>
            </div>

 
      </div>
    </div>
    <br><br>


      <a class="float trigger-btn" href="#itemModal" data-toggle="modal">
          <i class="fas fa-plus my-float"></i>
        </a>

              <!-- The Modal -->
              <div class="fade modal rounded-0" id="itemModal">
                <div class="modal-dialog h-100 my-0  d-flex flex-column justify-content-center">
                  <div class="modal-content rounded-0">

                    <!-- Modal Header -->
                    <div class="modal-header rounded-0">
                      <h4 class="modal-title">Add Menu Item</h4>
                      <button type="button" class="close" data-dismiss="modal">&times;</button>
                    </div>

                    <!-- Modal body -->
                    <div class="modal-body rounded-0">
                      <form action="#" id="item_form" onsubmit="event.preventDefault(); checkItem();">
                        <div class="form-group">
                          <label for="text">Item Name:</label>
                          <input type="text" class="form-control" id="item_name" required>
                        </div>
                        <div class="form-group">
                          <label for="number">Item Price:</label>
                          <input type="number" class="form-control" id="item_price" required step="0.01">
                        </div>
                        <div class="form-group">
                          <label for="sel1">Status</label>
                          <select class="form-control" id="item_status">
                            <option value="-1" selected>--</option>
                            <option value="1">Active</option>
                            <option value="0">Not-Active</option>
                          </select>
                        </div>
                      </form>
                    </div>

                    <!-- Modal footer -->
                    <div class="modal-footer rounded-0">
                      <button type="submit" form="item_form" class="btn btn-primary">Save</button>
                    </div>

                  </div>
                </div>
              </div>


  <!-- Bootstrap core JavaScript -->
  <script src="vendor/jquery/jquery.min.js"></script>
  <script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
  <!-- The core Firebase JS SDK is always required and must be listed first -->
  <script src="https://www.gstatic.com/firebasejs/7.13.2/firebase-app.js"></script>
  <!-- Add Firebase products that you want to use -->
  <script src="https://www.gstatic.com/firebasejs/7.13.2/firebase-database.js"></script>

  <script>

    let firebaseConfig = {
      apiKey: "AIzaSyDLrSd3njKWjmM7W9Oy_CmxsQ6RLfsJqCg",
      authDomain: "e-bazar-f36a6.firebaseapp.com",
      databaseURL: "https://e-bazar-f36a6.firebaseio.com",
      projectId: "e-bazar-f36a6",
      storageBucket: "e-bazar-f36a6.appspot.com",
      messagingSenderId: "442307013973",
      appId: "1:442307013973:web:4d7efafee476c323ec53dc",
      measurementId: "G-ZMND22GR0T"
    };

    firebase.initializeApp(firebaseConfig);
    let database = firebase.database();

    function logoutUser()
    {
      sessionStorage.clear();
      location.reload();
    }

    function getUser()
    {
        var user = sessionStorage.getItem("user");
        if(user != null) 
        {
            document.getElementById("user_login").innerHTML = user.toUpperCase();
            document.getElementById("user_menu").removeAttribute("style");
            document.getElementById("login_menu").remove();
        } else {

            window.location.replace(window.location.origin + "/e-bazar/login_restaurant.html");
        }

        checkMenu();
    }

    function writeUserData(item) 
    {

      let uid =  Math.random().toString(36).substring(2, 15) + Math.random().toString(36).substring(2, 15);

      firebase.database().ref('restaurant/' + sessionStorage.getItem("user")).push({
          menu: item 
      });
    }


    function checkItem() 
    {
      let name   = document.getElementById("item_name").value;
      let price  = document.getElementById("item_price").value;
      let status = document.getElementById("item_status");

      let item = 
      {
        name: name,
        price:price,
        status:status.options[status.selectedIndex].value
      }

      writeUserData(item);
    }

    let exclude = ['brand','collectionTime','cuisine','deliveryFee',
    'desc','location','maxDeliveryTime','minDeliveryTime','minOrderForDelivery','orderType','password','phone','username'];

    function checkMenu()
    {
        let userMenu = firebase.database().ref('restaurant/' + sessionStorage.getItem("user"));
        userMenu.on('value', function(snapshot) 
        {
            let obj = snapshot.val();
            let userMenu = document.getElementById("menu_list");

            userMenu.innerHTML = "";

            for (var key in obj) {

              if(exclude.indexOf(key) == -1)
              {  
                  // console.log(obj[key].menu);
                  userMenu.insertAdjacentHTML('beforeend', 
                    `<li class="list-group-item rounded-0">
                        <i class="fas fa-utensils mr-4 purple"></i> 
                          ${obj[key].menu.name}                          
                    </li>`);
              }

            }
        });
    }

  </script>
    
</body>

</html>
